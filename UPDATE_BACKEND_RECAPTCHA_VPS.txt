üöÄ CARA UPDATE BACKEND RECAPTCHA DI VPS
================================================

STATUS: SIAP DIJALANKAN DI VPS

## üìã YANG SUDAH SELESAI:
‚úÖ Code sudah di-push ke GitHub (commit: 6ee614a, a708c8e)
‚úÖ Frontend sudah update (ContactSection.tsx - invisible reCAPTCHA)
‚úÖ Backend sudah update (recaptchaVerify.js - secret key baru)
‚úÖ Environment variable lokal sudah diset

## üéØ YANG PERLU KAMU LAKUKAN:

### STEP 1: SSH ke VPS

```bash
ssh root@43.228.213.128
```

### STEP 2: Masuk ke Direktori Project

```bash
cd /root/n8n-production/portfolio
```

### STEP 3: Pull Code Terbaru dari GitHub

```bash
git pull origin main
```

**Expected Output:**
```
remote: Enumerating objects: X, done.
remote: Counting objects: 100% (X/X), done.
Updating abc1234..6ee614a
Fast-forward
 backend/src/middleware/recaptchaVerify.js | 2 +-
 porto/src/components/portfolio/ContactSection.tsx | 5 +++--
 2 files changed, 4 insertions(+), 3 deletions(-)
```

### STEP 4: Restart Backend Container

```bash
docker-compose restart backend
```

**Expected Output:**
```
Restarting portfolio-backend ... done
```

### STEP 5: Cek Logs Backend (Pastikan Tidak Ada Error)

```bash
docker-compose logs -f backend
```

**Expected Output:**
```
backend_1  | Server running on port 5000
backend_1  | Database connected successfully
```

**Tekan CTRL+C untuk keluar dari logs**

### STEP 6: Test Backend API (Optional)

```bash
curl -X POST https://api.4leafclover.id/api/messages \
  -H "Content-Type: application/json" \
  -d '{
    "name": "Test User",
    "email": "test@example.com",
    "message": "Testing reCAPTCHA",
    "recaptchaToken": "test"
  }'
```

**Expected Output (Error karena token invalid - ini normal!):**
```json
{
  "error": "reCAPTCHA verification failed",
  "details": ["Please try again or refresh the page"]
}
```

Kalau dapat error ini, berarti backend sudah bekerja dengan baik! ‚úÖ

---

## üåê STEP 7: Update Netlify Environment Variable

### 7.1. Buka Netlify Dashboard
1. Buka: https://app.netlify.com
2. Login dengan akun kamu
3. Pilih site: **4leafclover.id**

### 7.2. Set Environment Variable
1. Klik **"Site configuration"** di sidebar kiri
2. Klik **"Environment variables"**
3. Cari variable: `VITE_RECAPTCHA_SITE_KEY`
   - Kalau sudah ada, klik **"Edit"**
   - Kalau belum ada, klik **"Add a variable"**
4. Set value:
   ```
   Key: VITE_RECAPTCHA_SITE_KEY
   Value: 6Lf49T8sAAAAABpJ7AT8oV9JFNZw8rTQ6GxzTJt5
   ```
5. Klik **"Save"**

### 7.3. Trigger Redeploy
1. Klik **"Deploys"** di top menu
2. Klik **"Trigger deploy"** button
3. Pilih **"Deploy site"**
4. Tunggu sampai status berubah jadi **"Published"** (biasanya 2-3 menit)

---

## üß™ STEP 8: TEST DI PRODUCTION

### Test 1: Normal User
1. Buka: https://4leafclover.id
2. Scroll ke bagian **Contact**
3. Isi form:
   - Name: `Test User`
   - Email: `test@example.com`
   - Message: `Testing Invisible reCAPTCHA v2`
4. Klik **"Send Message"**

**Expected Result:**
- ‚úÖ Tidak ada checkbox reCAPTCHA (invisible!)
- ‚úÖ Langsung submit tanpa popup (kalau user normal)
- ‚úÖ Muncul toast: "Message sent successfully!"
- ‚úÖ Form ter-reset otomatis

### Test 2: Cek Badge reCAPTCHA
- Lihat di **pojok kanan bawah** halaman
- Harus ada badge kecil: **"reCAPTCHA"**
- Badge ini membuktikan reCAPTCHA aktif

### Test 3: Rate Limiting
1. Kirim 3 pesan berturut-turut (tunggu setiap pesan berhasil)
2. Coba kirim pesan ke-4
3. **Expected**: Error "Too many messages sent. Please try again after 15 minutes."

### Test 4: Suspicious Behavior (Optional)
1. Buka dalam **Incognito/Private mode**
2. Atau pakai **VPN**
3. Isi form dan submit
4. **Mungkin** muncul puzzle challenge dari Google
5. Selesaikan puzzle, message harus terkirim

---

## üîç TROUBLESHOOTING

### Problem 1: Git Pull Gagal
**Error:** `error: Your local changes to the following files would be overwritten by merge`

**Solution:**
```bash
# Backup perubahan lokal (kalau ada)
git stash

# Pull lagi
git pull origin main

# Restore perubahan (kalau perlu)
git stash pop
```

### Problem 2: Backend Tidak Restart
**Error:** `Error response from daemon: No such container`

**Solution:**
```bash
# Cek container yang running
docker ps

# Kalau tidak ada, start semua container
docker-compose up -d

# Cek logs
docker-compose logs -f backend
```

### Problem 3: reCAPTCHA Badge Tidak Muncul
**Possible Causes:**
- Netlify environment variable belum diset
- Netlify belum redeploy setelah set env var
- Browser cache

**Solution:**
1. Pastikan env var sudah diset di Netlify
2. Pastikan Netlify sudah redeploy
3. Clear browser cache (CTRL+SHIFT+DELETE)
4. Refresh halaman (CTRL+F5)

### Problem 4: reCAPTCHA Verification Failed
**Error di console:** `reCAPTCHA verification failed`

**Possible Causes:**
- Secret key di backend salah
- Backend belum restart setelah pull

**Solution:**
```bash
# SSH ke VPS
ssh root@43.228.213.128

# Masuk ke direktori
cd /root/n8n-production/portfolio

# Cek secret key di middleware
cat backend/src/middleware/recaptchaVerify.js | grep RECAPTCHA_SECRET_KEY

# Harus ada: 6Lf49T8sAAAAAACEiOAI6BuSvUsqZBPynKADEmm5I

# Restart backend
docker-compose restart backend
```

### Problem 5: Message Tidak Terkirim
**Error:** `Failed to send message`

**Check:**
1. Buka browser console (F12)
2. Lihat error message
3. Cek Network tab untuk melihat response dari API

**Common Issues:**
- reCAPTCHA token tidak ada ‚Üí Refresh halaman
- Rate limit exceeded ‚Üí Tunggu 15 menit
- Backend error ‚Üí Cek logs: `docker-compose logs backend`

---

## üìä VERIFICATION CHECKLIST

Setelah semua langkah selesai, pastikan:

- [ ] Backend di VPS sudah pull code terbaru
- [ ] Backend container sudah restart
- [ ] Backend logs tidak ada error
- [ ] Netlify environment variable sudah diset
- [ ] Netlify sudah redeploy
- [ ] Badge reCAPTCHA muncul di pojok kanan bawah
- [ ] Form contact bisa submit tanpa checkbox
- [ ] Message berhasil terkirim
- [ ] Rate limiting bekerja (max 3 pesan per 15 menit)

---

## üéâ SUCCESS INDICATORS

Kalau semua berhasil, kamu akan lihat:

1. **Di Frontend (https://4leafclover.id):**
   - ‚úÖ Badge reCAPTCHA kecil di pojok kanan bawah
   - ‚úÖ Tidak ada checkbox reCAPTCHA di form
   - ‚úÖ Form bisa submit dengan smooth
   - ‚úÖ Toast success muncul setelah submit

2. **Di Backend Logs:**
   ```
   POST /api/messages 200 - - ms
   ```

3. **Di Admin Panel (https://4leafclover.id/admin/messages):**
   - ‚úÖ Message baru muncul di list
   - ‚úÖ Status: "unread"
   - ‚úÖ Semua data lengkap (name, email, message)

---

## üìù NOTES PENTING

### Tentang Invisible reCAPTCHA:
- **Tidak ada checkbox** = User tidak perlu klik apapun
- **Badge kecil** = Hanya logo reCAPTCHA di pojok
- **Puzzle jarang muncul** = Hanya kalau Google curiga user adalah bot
- **UX lebih baik** = User tidak terganggu dengan checkbox

### Security Layers (3 Lapis):
1. **Rate Limiting** ‚è±Ô∏è = Max 3 pesan per 15 menit per IP
2. **Input Validation** üõ°Ô∏è = Validasi & sanitize semua input
3. **reCAPTCHA v2 Invisible** ü§ñ = Bot detection tanpa mengganggu UX

### Environment Variables:
- **Frontend (Netlify):** `VITE_RECAPTCHA_SITE_KEY` = Site Key (public)
- **Backend (VPS):** `RECAPTCHA_SECRET_KEY` = Secret Key (private)
- **PENTING:** Secret key TIDAK boleh di-commit ke Git!

---

## üÜò NEED HELP?

Kalau ada masalah:

1. **Cek logs backend:**
   ```bash
   ssh root@43.228.213.128
   cd /root/n8n-production/portfolio
   docker-compose logs -f backend
   ```

2. **Cek browser console:**
   - Buka https://4leafclover.id
   - Tekan F12
   - Lihat tab Console dan Network

3. **Test API langsung:**
   ```bash
   curl -X GET https://api.4leafclover.id/api/health
   ```

---

## ‚ú® SUMMARY

**RECAPTCHA V2 INVISIBLE SIAP DEPLOY!**

Tinggal jalankan 3 langkah utama:
1. ‚è≥ SSH ke VPS ‚Üí Pull code ‚Üí Restart backend
2. ‚è≥ Set Netlify env var ‚Üí Redeploy
3. ‚è≥ Test di production

Setelah itu, contact form akan terlindungi dari spam bot dengan UX yang seamless! üõ°Ô∏è‚ú®

**Estimated Time:** 10-15 menit
**Difficulty:** Easy (tinggal copy-paste command)

Good luck! üöÄ
