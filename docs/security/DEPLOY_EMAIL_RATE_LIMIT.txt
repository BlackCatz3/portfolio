ğŸš€ DEPLOY EMAIL RATE LIMITING FEATURE
=======================================

## âœ… CODE SUDAH DI-PUSH KE GITHUB!

Sekarang tinggal deploy ke VPS dan create database tables.

---

## ğŸ“‹ LANGKAH DEPLOY:

### STEP 1: Pull Latest Code & Create Tables

```bash
ssh root@43.228.213.128 "cd /root/n8n-production/portfolio && git pull origin main && docker exec -it portfolio-backend node src/database/create-rate-limit-tables.js && docker compose restart backend && docker logs portfolio-backend --tail 30"
```

Password VPS: `Y2BNxabkpqXTR58y`

---

### STEP 2: Verify Deployment

**Check backend logs:**
```bash
ssh root@43.228.213.128
docker logs portfolio-backend --tail 50 -f
```

Look for:
- âœ… `Database connected successfully`
- âœ… `Server is running on port 5000`
- âœ… `Rate limit tables created successfully`

---

### STEP 3: Test dari Admin

1. **Login Admin:**
   https://4leafclover.id/admin

2. **Buka Settings:**
   Menu: Settings â†’ Tab: Rate Limiting

3. **Configure Settings:**
   - Max Messages per Email: 3
   - Time Window: 60 minutes
   - Enable: ON
   - Save Settings

4. **Test dari Frontend:**
   - Buka: https://4leafclover.id
   - Kirim 3 pesan dengan email yang sama
   - Pesan ke-4 harus error: "Too many messages from this email"

---

## ğŸ¯ DEFAULT SETTINGS:

Setelah migration, default settings:
- Max Messages per Email: 3
- Time Window: 60 minutes
- Enabled: true

Kamu bisa ubah dari Admin Settings!

---

## ğŸ“Š MONITORING:

### Check Email Rate Limit Stats:

Login admin â†’ Settings â†’ Rate Limiting

Atau via backend logs:
```bash
docker logs portfolio-backend | grep "Email rate limit"
```

Output:
```
âœ… Email rate limit: test@gmail.com - 1/3 messages
âœ… Email rate limit: test@gmail.com - 2/3 messages
âœ… Email rate limit: test@gmail.com - 3/3 messages
âš ï¸ Email rate limit exceeded: test@gmail.com - 3/3 messages
```

---

## ğŸ”§ TROUBLESHOOTING:

### Problem: Migration Failed

**Solution:**
```bash
# SSH ke VPS
ssh root@43.228.213.128

# Check if tables exist
docker exec -it portfolio-db psql -U postgres -d portfolio_cms_2026 -c "\dt"

# If not exist, run migration manually
docker exec -it portfolio-backend node src/database/create-rate-limit-tables.js
```

### Problem: Settings Not Showing in Admin

**Solution:**
1. Clear browser cache
2. Hard refresh (Ctrl + Shift + R)
3. Check Netlify deployment status
4. Wait for auto-deploy to complete

### Problem: Rate Limiting Not Working

**Solution:**
1. Check if enabled in Admin Settings
2. Check backend logs for errors
3. Verify database tables exist
4. Restart backend: `docker compose restart backend`

---

## âœ… EXPECTED RESULTS:

**Setelah deploy:**
- âœ… Admin Settings ada tab "Rate Limiting"
- âœ… Bisa atur max messages dan time window
- âœ… Bisa enable/disable rate limiting
- âœ… Email yang sama tidak bisa spam
- âœ… Backend logs menunjukkan rate limit tracking
- âœ… 11 layer protection aktif!

---

## ğŸ“ QUICK COMMANDS:

**Deploy:**
```bash
ssh root@43.228.213.128 "cd /root/n8n-production/portfolio && git pull && docker exec -it portfolio-backend node src/database/create-rate-limit-tables.js && docker compose restart backend"
```

**Check logs:**
```bash
ssh root@43.228.213.128
docker logs portfolio-backend --tail 100 -f
```

**Check tables:**
```bash
docker exec -it portfolio-db psql -U postgres -d portfolio_cms_2026 -c "SELECT * FROM rate_limit_settings;"
```

---

Jalankan STEP 1 sekarang untuk deploy! ğŸš€
